@use '/src/styles/abstracts' as *;

// ==========================================================================
// TILES & COLLECTIONS
// Mantra: "Windows into Data."
// ==========================================================================

// 1. THE COLLECTION (Horizontal Scroll Container)
// --------------------------------------------------------------------------
.tiles-collection {
  width: 100%; 
  min-height: 18rem;
  display: flex;
  flex-flow: row nowrap;
  justify-content: flex-start;
  align-items: center;
  gap: 1.5rem;
  
  // Padding respects the container layout but adds vertical breathing room
  padding: 0.5rem 1.5rem 2rem 1.5rem;
    
  overflow-x: auto;
  overflow-y: hidden;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  
  // --- DYNAMIC LASER SCROLLBARS ---
  scrollbar-width: thin;
  scrollbar-color: var(--energy-secondary) transparent;

  &::-webkit-scrollbar { 
    height: 4px; 
  }
  
  &::-webkit-scrollbar-track { 
    background: rgba(255, 255, 255, 0.02); 
    border-radius: 4px; 
    
    // Paper Override
    @at-root [data-atmosphere='paper'] & {
      background: rgba(0,0,0,0.05);
    }
  }
  
  &::-webkit-scrollbar-thumb { 
    background: linear-gradient(90deg, var(--energy-secondary), var(--energy-primary)); 
    border-radius: 4px;
    
    &:hover { 
      background: var(--energy-primary); 
      // Glow works in Void, becomes simple color in Paper
      box-shadow: 0 0 10px color-mix(in srgb, var(--energy-primary), transparent 40%);
    }
  }
}

// 2. THE STORY TILE (Holographic Slate)
// --------------------------------------------------------------------------
.tile {
  position: relative;
  flex: none;
  width: 10rem; // Mobile width
  aspect-ratio: 2 / 3;
    
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
    
  // --- PHYSICS BASE ---
  // We use the mixin for borders/shadows, but override background/padding
  @include glass-float($interactive: true);
  padding: 0; // Images are full bleed
  background: var(--bg-sink); // Darker than standard cards
  
  text-decoration: none !important;
  overflow: hidden;
  border-radius: 12px; // Fixed visually pleasing radius
  border-width: 2px;
  
  // Explicit transition for hover effects
  transition: 
    transform var(--speed-base) var(--ease-stabilize), 
    border-color var(--speed-base) var(--ease-snap),
    box-shadow var(--speed-base) var(--ease-snap);

  // --- THE IMAGE ---
  img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: z('floor');
    transition: transform var(--speed-base) var(--ease-stabilize); // Smooth pan effect
  }

  // --- THE ATMOSPHERIC GRADIENT (The "Scuba Dive") ---
  // This gradient ensures text is legible at the bottom.
  // It uses var(--bg-canvas) so it fades perfectly into Void, Crimson, or White.
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      transparent 40%,        // Keep top clear
      color-mix(in srgb, var(--bg-canvas), transparent 60%) 60%, 
      color-mix(in srgb, var(--bg-canvas), transparent 10%) 80%, 
      var(--bg-canvas) 100%   // Solid Floor
    );
    z-index: z('base');
    pointer-events: none;
  }

  // --- CONTENT LAYOUT ---

  h5 {
    position: relative;
    z-index: z('decorate');
    margin: 0;
    padding: 0 0.75rem 0.25rem 0.75rem;
    
    font-family: var(--font-heading);
    color: var(--text-main);
    font-weight: 700;
    font-size: 1rem;
    line-height: 1.2;
    
    // Text shadow for legibility over image
    text-shadow: 0 2px 4px rgba(0,0,0,0.9); 
    
    @at-root [data-atmosphere='paper'] & {
       // color: #FFFFFF; // Always white text over image, even in Paper mode
       // text-shadow: 0 2px 8px rgba(0,0,0,0.8);
       text-shadow: none;
    }
  }

  .tile-data {
    position: relative;
    z-index: z('decorate');
    padding: 0 0.75rem 0.75rem 0.75rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    
    p, span {
      font-size: 0.75rem;
      color: var(--text-mute);
      transition: color 0.3s ease;
      
      @at-root [data-atmosphere='paper'] & {
         color: rgba(255,255,255,0.7); // Light grey on image
      }
    }
  }

  // --- INTERACTION ---
  @media (hover: hover) {
    &:hover:not(.loading-tile),
    &:focus-visible:not(.loading-tile) {
      // Logic handled by mixin, but we add image scale here
      img { transform: scale(1.05); }
      
      // Light up metadata
      .tile-data p { 
        color: var(--text-main); 
        @at-root [data-atmosphere='paper'] & { color: #FFFFFF; }
      } 

      @at-root [data-atmosphere='terminal'] & {
        img { transform: scale(1.01); }
      }
    }
  }

  // --- RESPONSIVE WIDTHS ---
  // Using standard breakpoints logic
  @media (min-width: 768px) { width: 14rem; }
  @media (min-width: 1440px) { width: 16rem; }
  @media (min-width: 1920px) { width: 18rem; } 
}

// 3. LOADING TILE (Skeleton)
// --------------------------------------------------------------------------
.loading-tile {
  @extend .tile; 
  background: var(--bg-sink);
  pointer-events: none; // Non-interactive
  
  // Clean slate for the skeleton
  h5, .tile-data, img { opacity: 0; } 
  
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: z('float');

    // Apply the animation mixin
    @include shimmer;
  }
}