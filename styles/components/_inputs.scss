@use '/src/styles/abstracts' as *;
@use 'buttons';

// ==========================================================================
// INPUTS & FORMS (Native-First)
// Mantra: "Reliability over Flash."
// ==========================================================================

// 1. GLOBAL FORM DEFAULTS
// --------------------------------------------------------------------------
:where(input, select, textarea) {
  // This ensures the native browser UI (Calendar pickers, Arrows)
  // adapts to the dark background automatically.
  color-scheme: dark;

  // Paper Mode Exception
  @at-root [data-atmosphere='paper'] & {
    color-scheme: light;
  }
}

// 2. TEXT FIELDS (Text, Password, Email, Textarea)
// --------------------------------------------------------------------------
// We still apply the "Sunk" look to the box itself, as this is safe styling.
input:not([type='checkbox']):not([type='radio']):not([type='range']):not([type='file']),
textarea,
select {
  appearance: none; // Reset default borders
  width: 100%;
  min-height: 2.75rem; 
  padding: 0.75rem 1rem;
  border-radius: 8px; 
  
  font-family: var(--font-body);
  font-size: 1rem;
  color: var(--text-main); 
  
  // Use the Sunk Mixin for the container physics
  @include glass-sunk;

  // Standard Transitions
  transition: 
    border-color var(--speed-fast) var(--ease-snap),
    box-shadow var(--speed-fast) var(--ease-snap),
    background-color var(--speed-fast) var(--ease-flow);

  &::placeholder {
    color: var(--text-mute);
    opacity: 0.7; 
  }

  // Focus State
  &:focus {
    outline: none;
    border-color: var(--energy-primary);
    // Glow handled by mixin
  }

  // Error State
  &.has-error, 
  &:invalid:not(:placeholder-shown) {
    border-color: var(--color-error);
    color: var(--color-error);
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none; 
    background: rgba(255,255,255,0.05);
  }
}

textarea {
  min-height: 8rem;
  resize: vertical;
}

// 3. SELECT DROPDOWNS (Native)
// --------------------------------------------------------------------------
select {
  // Restore the native arrow, but keep our box styling.
  appearance: auto; 
  
  // Ensure the arrow isn't right up against the text
  padding-right: 2.5rem; 
  cursor: pointer;
  
  // Background color fix for Chrome/Safari to ensure options are readable
  // (The dropdown menu itself is handled by the OS/Browser)
  background-color: var(--bg-sink);
}

// 4. RANGE SLIDERS (Native + Accent)
// --------------------------------------------------------------------------
input[type=range] {
  appearance: auto; // Let the browser draw the track
  width: 100%; 
  min-height: 2rem;
  padding: 0;
  border: none;
  background: transparent;
  box-shadow: none; // No box shadow on the container
  
  // MAGIC PROPERTY:
  // Paints the thumb and track in our Primary Energy color.
  // Works for Void (Cyan), Terminal (Amber), Paper (Ink).
  accent-color: var(--energy-primary);
  
  cursor: pointer;

  &:focus {
    outline: none;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

// 5. CHECKBOXES & RADIOS (Native + Accent)
// --------------------------------------------------------------------------
input[type='checkbox'],
input[type='radio'] {
  appearance: auto;
  width: 1.25rem;
  height: 1.25rem;
  
  // MAGIC PROPERTY:
  accent-color: var(--energy-primary);
  
  cursor: pointer;
  vertical-align: middle;
  margin-right: 0.5rem;
  
  // Slight filter to match the "Glow" vibe in Void mode only
  // (Accent color handles the hue, this adds a slight shine)
  @media (prefers-color-scheme: dark) {
     filter: drop-shadow(0 0 2px var(--energy-primary));
  }
  
  // Remove glow in Paper/Terminal
  @at-root [data-atmosphere='paper'] &,
  [data-atmosphere='terminal'] & {
    filter: none;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    filter: none; 
  }
}

// 6. FILE DROPZONE (The "Invisible Click" Trick)
// --------------------------------------------------------------------------
.dropzone {
  position: relative; // Crucial for overlaying
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  
  // Layout
  padding: 1.5rem; 
  width: 100%;
  min-height: 10rem; // Give it some vertical breathing room
  border-radius: 1rem;
  
  // Style
  border: 2px dashed color-mix(in srgb, var(--energy-secondary), transparent 70%);
  @include glass-sunk; 
  border-style: dashed; // Override sunk solid border
  
  cursor: pointer;
  transition: all var(--speed-fast) var(--ease-flow);

  // --- A. THE REAL INPUT (Invisible Layer) ---
  // We stretch this over the entire parent. It captures all clicks and drops.
  input[type="file"] {
    position: absolute;
    inset: 0;           // Stretch to corners
    width: 100%;
    height: 100%;
    opacity: 0;         // Invisible but clickable
    cursor: pointer;
    z-index: z('float'); // Sit on top
  }

  // --- B. THE FAKE CONTENT (Visible Layer) ---
  // This sits underneath the invisible input.
  .dropzone-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    pointer-events: none; // Let clicks pass through to the input
    z-index: z('base'); // Sit above the sunk background
    
    // Icon styling
    svg, .btn-icon {
      width: 48px;
      height: 48px;
      font-size: 32px;
      color: var(--text-mute);
      transition: color var(--speed-fast) var(--ease-flow);
    }
    
    // Text styling
    p {
      color: var(--text-mute);
      margin: 0;
    }
    
    .btn-fake {
      // Looks like a button, but isn't one
      @extend .btn; // Inherit your button styles
      @extend .btn-void; // Or use a void button look
      color: var(--energy-primary);
      pointer-events: none;
    }
  }

  // --- INTERACTION STATES ---
  
  // Hover or Drag Active
  &:hover, 
  &.drag-active,
  &:focus-within {
    border-color: var(--energy-primary);
    background-color: color-mix(in srgb, var(--bg-sink), var(--energy-primary) 5%);
    
    // Energize the content
    .dropzone-content {
      svg, .btn-icon { color: var(--energy-primary); }
      p { color: var(--text-main); }
    }
    
    @at-root [data-atmosphere='paper'] & {
      background-color: #F0F9FF; 
      border-color: var(--energy-primary);
      .dropzone-content svg { filter: none; }
    }
  }
}