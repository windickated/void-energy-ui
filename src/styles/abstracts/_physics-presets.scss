/* ==========================================================================
   üåå VOID PHYSICS ENGINE
   ==========================================================================
   
   PURPOSE:
   This file defines the "Material Properties" of the interface. 
   While `_user-themes.scss` controls COLOR (The Soul), this file controls 
   BEHAVIOR (The Body).

   WHY DO WE NEED THIS?
   By separating Physics from Color, we can mix and match realities.
   - A "Void" theme can look like Glass (Modern) or Flat (Print).
   - A "Terminal" theme is defined by its motion (instant) and geometry (sharp),
     regardless of whether it is Green, Amber, or Blue.

   THE THREE LAWS OF PHYSICS:
   1. TEXTURE: How does light pass through? (Blur, Opacity)
   2. GEOMETRY: What is the shape? (Radius, Border Width)
   3. TIME:    How does it move? (Speed, Easing)

   --------------------------------------------------------------------------
   PROPERTY DICTIONARY
   --------------------------------------------------------------------------
   
   --- TEXTURE & GEOMETRY ---
   $physics-blur         : Backdrop blur strength. High = Glass/Water. 0px = Air/Solid.
   $physics-border-width : Thickness of the container shell.
   $radius-base          : Corner roundness. 0px = Retro/Machine. 8px+ = Organic.
   
   --- LIGHTING & DEPTH ---
   $border-mode          : Logic for rendering borders.
                           - 'directional': Top border is lighter (Light from above). Used for 3D Glass.
                           - 'uniform':     All borders are equal. Used for 2D Paper or Retro screens.
   $border-opacity       : Base transparency of the border lines.
   $glow-opacity         : Baseline inner-glow for interactive elements.
   $glow-strength        : Multiplier for hover states (0 = No reaction, 1 = Full neon).
   $shadow-strength      : Multiplier for depth shadows (0 = Flat).
   $void-shadow          : The specific drop-shadow CSS value for floating depth.

   --- TIME (MOTION) ---
   $speed-base           : Duration of transitions. 0s = Instant/Robotic.
   $ease-base            : The math of movement. Linear, Ease-Out, or Steps.
   
   ==========================================================================
   ‚ö†Ô∏è SYSTEM ARCHITECTURE WARNING
   --------------------------------------------------------------------------
   The variables defined here are TIER 2 (System Controlled).
   They are calculated based on the 'physics' mode ('glass', 'flat', 'retro').

   ‚ùå DO NOT OVERRIDE THESE MANUALLY IN THEMES.
   ‚ùå DO NOT USE THESE FOR COLOR (Use --energy-* or --bg-* instead).

   ‚úÖ READ-ONLY API:
   - var(--physics-blur)
   - var(--physics-border-width)
   - var(--speed-base) / var(--speed-fast)
   - var(--ease-snap) / var(--ease-flow)
   ========================================================================== */

@use 'sass:map';
@use '../config/generated-themes' as generated;
@use 'functions' as *;

// 1. THE DEFINITIONS
$physics-presets: (
  'glass': map.merge(
      map.get(generated.$generated-physics, 'glass'),
      (
        'radius-base': var(--radius-md),
        'base-glow-opacity': 0.6,
        'base-shadow-opacity': 0.5,
        'surface-bg': linear-gradient(
            to bottom,
            color-mix(in srgb, var(--bg-surface), var(--energy-secondary) 10%)
              0%,
            var(--bg-surface) 100%
          ),
        'surface-border-top': color-mix(
            in srgb,
            var(--border-highlight),
            transparent 0%
          ),
        'surface-border-side': color-mix(
            in srgb,
            var(--border-shadow),
            transparent 0%
          ),
        'surface-shadow': 0 4px 16px rgba(0, 0, 0, 0.5),
        'hover-transform': translateY(-2px),
        'hover-shadow': 0 8px 32px rgba(0, 0, 0, 0.5),
      )
    ),
  'flat': map.merge(
      map.get(generated.$generated-physics, 'flat'),
      (
        'radius-base': var(--radius-sm),
        'base-glow-opacity': 0,
        'base-shadow-opacity': 0.1,
        'surface-bg': var(--bg-surface),
        'surface-border-top': var(--border-highlight),
        'surface-border-side': var(--border-highlight),
        'surface-shadow': 0 2px 8px rgba(0, 0, 0, 0.08),
        'hover-transform': translateY(-1px),
        'hover-shadow': 0 4px 12px rgba(0, 0, 0, 0.12),
      )
    ),
  'retro': map.merge(
      map.get(generated.$generated-physics, 'retro'),
      (
        'radius-base': 0px,
        'base-glow-opacity': 0,
        'base-shadow-opacity': 1,
        'surface-bg': var(--bg-surface),
        'surface-border-top': var(--border-highlight),
        'surface-border-side': var(--border-highlight),
        'surface-shadow': none,
        'hover-transform': none,
        'hover-shadow': 4px 4px 0px alpha(var(--energy-primary), 25%),
      )
    ),
);

// 2. THE EMITTER (Logic Layer)
@mixin emit-physics {
  // A. Emit Physics Presets
  @each $name, $map in $physics-presets {
    [data-physics='#{$name}'] {
      @each $key, $val in $map {
        // Output every key in the map as a CSS variable
        --#{$key}: #{$val};
      }
    }
  }

  // B. Emit Optics (Unchanged)
  [data-mode='dark'] {
    --optics-glow-mult: 1;
    --optics-shadow-mult: 1;
    --optics-text-glow: 1;
  }
  [data-mode='light'] {
    --optics-glow-mult: 0;
    --optics-shadow-mult: 0.5;
    --optics-text-glow: 0;
  }
}
