/*
 * ROLE: Dialog and modal styling.
 * RESPONSIBILITY: Applies holographic materialization physics to native <dialog> elements and their backdrops.
 */

@use '../abstracts' as *;

// ==========================================================================
// DIALOGS & MODALS
// Materialize from blur, dematerialize upward, and anchor at modal depth.
// ==========================================================================

dialog {
  // --- 1. LAYOUT & POSITION ---
  position: fixed;
  margin: auto; // Centers native dialogs
  padding: 0; // Reset, let inner container handle it
  inset: 0; // Ensure full screen centering context
  overscroll-behavior: contain; // Prevents scroll chaining to the body

  z-index: z('modal'); // Layer: Modal

  // RESPONSIVE WIDTH STRATEGY
  // ------------------------------------------------------------------------
  // Default: "Standard" (Good for forms/inputs)
  // Logic: "Take full width minus 2rem padding, BUT cap at 32rem (512px)."
  width: min(calc(100vw - 2rem), 32rem);
  // Max Height: Ensure header/footer don't get cut off on short screens
  max-height: calc(100dvh - 4rem);

  // Tablet+: Let it breathe a bit more
  @include respond-up('tablet') {
    width: min(calc(100vw - 4rem), 40rem); // ~640px
  }

  // A. "Mini" (Alerts / Confirmations / Delete)
  &.dialog-sm {
    width: min(calc(100vw - 2rem), 24rem); // ~380px (Tight)
    text-align: center; // Usually centered text for alerts
  }

  // B. "Wide" (Complex Grids / File Uploads)
  &.dialog-lg {
    width: min(calc(100vw - 2rem), 64rem); // ~1024px
    max-width: 1200px; // Hard cap for ultrawide
  }

  // C. "Full" ( immersive takeovers)
  &.dialog-full {
    width: calc(100vw - 2rem);
    height: calc(100dvh - 2rem);
    max-height: none;
  }

  // --- 2. VOID STYLING ---
  border: none;
  border-radius: calc(var(--radius-base) * 2);
  color: var(--text-main);

  // Extra Depth: Modals float higher than cards
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);

  // --- 3. ANIMATION PHYSICS (The Materialize Effect) ---
  // DEFAULT STATE (Open)
  opacity: 1;
  transform: scale(1) translateY(0);
  filter: blur(0);

  // Apply Glass Physics (Static: No hover movement)
  @include glass-float($interactive: false);

  // --- 4. PROGRESSIVE ENHANCEMENT ---
  // We check if the browser supports animating 'display'.
  // If not, we skip ALL transition logic to prevent "Jumpy" or "Stuck" states.
  @supports (transition-behavior: allow-discrete) {
    // The "Materialize" Transitions
    transition:
      opacity var(--speed-base) var(--ease-flow),
      transform var(--speed-base) var(--ease-snap),
      filter var(--speed-base) var(--ease-flow),
      display var(--speed-base) allow-discrete,
      overlay var(--speed-base) allow-discrete;

    // ENTRY STATE (@starting-style)
    @starting-style {
      opacity: 0;
      transform: scale(0.95) translateY(10px);
      filter: blur(var(--physics-blur));
    }

    // EXIT STATE
    // When 'open' is removed (this only works with allow-discrete)
    &:not([open]) {
      opacity: 0;
      transform: scale(0.95) translateY(-10px);
      filter: blur(var(--physics-blur));
    }
  }

  // --- 6. BACKDROP (The Overlay) ---
  &::backdrop {
    // Dynamic: Deep Blue in Void, Dark Grey in Paper
    background: fade(var(--bg-canvas), 20%);
    opacity: 1;

    // Light Mode Exception: Standard dark overlay
    @at-root [data-mode='light'] & {
      background: rgba(0, 0, 0, 0.5);
    }

    // Only animate backdrop if supported
    @supports (transition-behavior: allow-discrete) {
      transition:
        opacity var(--speed-base) var(--ease-flow),
        display var(--speed-base) allow-discrete,
        overlay var(--speed-base) allow-discrete;

      @starting-style {
        opacity: 0;
      }

      &:not([open]) {
        opacity: 0;
      }
    }
  }

  // --- 7. INNER CONTENT LAYOUT ---
  // We target a direct child div to handle padding/scroll
  & > div {
    display: flex;
    flex-flow: column nowrap;
    padding: 2rem;
    gap: 1.5rem;

    // Typography
    h2,
    h3 {
      color: var(--text-main);
      margin: 0;
      font-family: var(--font-heading);
    }

    p {
      color: var(--text-dim);
      line-height: 1.6;
    }
  }

  // --- 8. SCROLLBARS (Neon Stream) ---
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: var(--energy-secondary) transparent;

  &::-webkit-scrollbar {
    width: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
    margin-block: 0.5rem;
  }

  &::-webkit-scrollbar-thumb {
    background: linear-gradient(
      to bottom,
      var(--energy-secondary),
      var(--energy-primary)
    );
    border-radius: 10px;

    &:hover {
      background: var(--energy-primary);
      box-shadow: 0 0 10px var(--energy-primary);
    }
  }

  // --- 9. LIGHT MODE OVERRIDE ---
  @at-root [data-mode='light'] & {
    background: var(--bg-surface);
    border: var(--physics-border-width) solid var(--border-highlight);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); // Clean shadow
    border-radius: var(--radius-base);

    // Crisp entry, no blur
    @starting-style {
      opacity: 0;
      transform: scale(0.95);
      filter: none;
    }

    &:not([open]) {
      opacity: 0;
      transform: scale(0.95);
      filter: none;
    }
  }
}
