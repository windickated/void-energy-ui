@use 'sass:map';
@use '../abstracts' as *;
@use 'animations' as *;

/* ==========================================================================
   VOID ENERGY UTILITY SYSTEM
   ==========================================================================
   
   PURPOSE:
   Atomic, immutable utility classes for rapid UI composition.
   Now features RESPONSIVE prefixes and SEMANTIC aliases.

   --------------------------------------------------------------------------
   See global.scss for full API documentation.
   -------------------------------------------------------------------------- */

// ==========================================================================
// 0. CONFIGURATION (Local Maps)
// ==========================================================================

// Map pixels to semantic sizes
$spacing-scale: (
  '0': 0,
  '8': 0.5rem,
  '16': 1rem,
  '24': 1.5rem,
  '32': 2rem,
  '48': 3rem,
  '64': 4rem,
);

$spacing-aliases: (
  'xs': '8',
  'sm': '16',
  'md': '24',
  'lg': '32',
  'xl': '64',
);

// ==========================================================================
// 1. UTILITY GENERATOR MIXIN
// ==========================================================================
// This mixin contains all classes that need to be responsive.
// We call this once for base styles, and again for every breakpoint.

@mixin generate-utilities($prefix: '') {
  // --- LAYOUT & DISPLAY ---
  .#{$prefix}hidden {
    display: none !important;
  }
  .#{$prefix}block {
    display: block;
  }
  .#{$prefix}inline {
    display: inline-block;
  }

  .#{$prefix}flex {
    display: flex;
  }
  .#{$prefix}flex-col {
    display: flex;
    flex-direction: column;
  }
  .#{$prefix}flex-row {
    display: flex;
    flex-direction: row;
  }

  // Alignment Shortcuts
  .#{$prefix}flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .#{$prefix}flex-center-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  // Flex Modifiers
  .#{$prefix}items-center {
    align-items: center;
  }
  .#{$prefix}items-start {
    align-items: flex-start;
  }
  .#{$prefix}items-end {
    align-items: flex-end;
  }
  .#{$prefix}items-stretch {
    align-items: stretch;
  }

  .#{$prefix}justify-center {
    justify-content: center;
  }
  .#{$prefix}justify-between {
    justify-content: space-between;
  }
  .#{$prefix}justify-start {
    justify-content: flex-start;
  }
  .#{$prefix}justify-end {
    justify-content: flex-end;
  }

  .#{$prefix}flex-wrap {
    flex-wrap: wrap;
  }
  .#{$prefix}flex-nowrap {
    flex-wrap: nowrap;
  }
  .#{$prefix}flex-1 {
    flex: 1;
  }

  // Grid Modifiers
  .#{$prefix}grid { display: grid; }
  .#{$prefix}grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
  .#{$prefix}grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }

  // --- SIZING ---
  .#{$prefix}w-full {
    width: 100%;
  }
  .#{$prefix}w-auto {
    width: auto;
  }
  .#{$prefix}h-full {
    height: 100%;
  }
  .#{$prefix}h-auto {
    height: auto;
  }

  // --- SPACING LOOP (Gaps, Padding, Margins) ---
  @each $key, $val in $spacing-scale {
    // 1. Pixel Literals (e.g., .gap-16)
    .#{$prefix}gap-#{$key} {
      gap: $val;
    }
    .#{$prefix}pad-#{$key} {
      padding: $val;
    }
    .#{$prefix}mar-#{$key} {
      margin: $val;
    }

    .#{$prefix}pad-top-#{$key} {
      padding-top: $val;
    }
    .#{$prefix}pad-bot-#{$key} {
      padding-bottom: $val;
    }

    .#{$prefix}mar-top-#{$key} {
      margin-top: $val;
    }
    .#{$prefix}mar-bot-#{$key} {
      margin-bottom: $val;
    }
    .#{$prefix}mar-y-#{$key} {
      margin-block: $val;
    }
  }

  // --- SEMANTIC ALIASES (e.g., .gap-md) ---
  @each $alias, $key in $spacing-aliases {
    $val: map.get($spacing-scale, $key);

    .#{$prefix}gap-#{$alias} {
      gap: $val;
    }
    .#{$prefix}pad-#{$alias} {
      padding: $val;
    }
    .#{$prefix}mar-#{$alias} {
      margin: $val;
    }
    .#{$prefix}mar-y-#{$alias} {
      margin-block: $val;
    }
  }
}

// ==========================================================================
// 2. GENERATE CLASSES
// ==========================================================================

// A. BASE CLASSES (Mobile / Default)
// No prefix. Works everywhere.
@include generate-utilities('');

// Special non-responsive base helpers
.w-screen {
  width: 100vw;
}
.h-screen {
  height: 100vh;
  height: 100dvh;
}
.min-h-screen {
  min-height: 100vh;
  min-height: 100dvh;
}
.max-w-full {
  max-width: 100%;
}
.mar-auto {
  margin-inline: auto;
}
.pad-inline {
  padding-inline: 1.5rem;
}

// B. RESPONSIVE LOOP
// Iterates through your global $breakpoints map
@each $breakpoint-name, $breakpoint-value in $breakpoints {
  // Skip the 'mobile' 0 value, as that is the base above
  @if $breakpoint-value != 0 {
    @include respond-up($breakpoint-name) {
      // The slash \ is needed to escape the colon in CSS class names
      @include generate-utilities('#{$breakpoint-name}\\:');
    }
  }
}

// ==========================================================================
// 3. VISUAL PHYSICS & ANIMATIONS (Static / Non-Responsive)
// ==========================================================================

// Blur
.blur {
  -webkit-backdrop-filter: blur(var(--physics-blur));
  backdrop-filter: blur(var(--physics-blur));
}

// Border Radius
.round-none {
  border-radius: 0;
}
.round-sm {
  border-radius: calc(var(--radius-base) * 0.5);
}
.round-md {
  border-radius: var(--radius-base);
}
.round-lg {
  border-radius: calc(var(--radius-base) * 1.5);
}
.round-xl {
  border-radius: calc(var(--radius-base) * 2);
}
.round-full {
  border-radius: 9999px;
}

// Entry Animations
.fade-in {
  @include entry-transition;
}

// Delays
.delay-1 {
  transition-delay: 50ms;
}
.delay-2 {
  transition-delay: 100ms;
}
.delay-3 {
  transition-delay: 150ms;
}
.delay-4 {
  transition-delay: 200ms;
}
.delay-5 {
  transition-delay: 250ms;
}

// Loading
.shimmer {
  @include shimmer;
}
.loading-logo {
  width: 8rem;
  aspect-ratio: 1/1;
  animation: logo-enter 1.2s var(--ease-snap) forwards;
}

// Interactive
.cyber-pulse {
  animation: cyber-pulse 3s var(--ease-pulse) infinite;
}

// Progress
.progress-bar {
  width: 100%;
  height: 4px;
  background: var(--bg-sink);
  border-radius: 2px;
  overflow: hidden;

  span {
    display: block;
    height: 100%;
    background: linear-gradient(
      135deg,
      var(--energy-primary),
      var(--energy-secondary)
    );
    box-shadow: 0 0 10px fade(var(--energy-primary), 40%);
    border-radius: inherit;
    animation: progress-fill 2s ease-out forwards;
  }
}

// ==========================================================================
// 4. TEXT UTILITIES
// ==========================================================================

.text-center {
  text-align: center;
}
.text-right {
  text-align: right;
}
.text-left {
  text-align: left;
}

.text-success {
  color: var(--color-success);
}
.text-error {
  color: var(--color-error);
}
.text-premium {
  color: var(--color-premium);
}
.text-system {
  color: var(--color-system);
}

.text-highlight {
  @include text-glow;
  font-weight: 600;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// --------------------------------------------------------------------------
// 7. ICONS & MEDIA
// --------------------------------------------------------------------------

.icon {
  // Sizing: scales with text (1.25em = slightly larger than text for balance)
  width: 1.25em;
  height: 1.25em;
  min-width: 1.25em; // Critical: Prevents squishing inside Flex containers

  // Alignment: Centers nicely with text line-height
  display: inline-block;
  vertical-align: middle;

  // Color: Inherits from parent (Button/Text)
  color: inherit;

  // Physics: Prepare for hover transforms
  transition: transform var(--speed-fast) var(--ease-snap);
}

// Icon Modifiers
.icon-sm {
  width: 1em;
  height: 1em;
  min-width: 1em;
}
.icon-lg {
  width: 1.5em;
  height: 1.5em;
  min-width: 1.5em;
}
.icon-xl {
  width: 2em;
  height: 2em;
  min-width: 2em;
}

// Spin Utility (for loading icons)
.icon-spin {
  animation: rotate-laser 2s linear infinite; // Re-using your existing rotation keyframe
}
