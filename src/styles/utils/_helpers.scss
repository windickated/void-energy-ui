/*
 * ROLE: Utility class generator (The "Fake Tailwind" Engine).
 * RESPONSIBILITY: Generates atomic layout, spacing, and visual helpers that mimic Tailwind syntax.
 */

@use '../abstracts' as *;
@use 'animations' as *;
@use 'sass:string';

// ==========================================================================
// 1. CONFIGURATION MAPS
// ==========================================================================

// Layout & Display
$display-map: (
  'hidden': none,
  'block': block,
  'inline-block': inline-block,
  'flex': flex,
  'grid': grid,
  'contents': contents,
);

// Flexbox Directions
$flex-dir-map: (
  'flex-row': row,
  'flex-col': column,
  'flex-wrap': wrap,
  'flex-nowrap': nowrap,
);

// Alignment (Items & Justify)
$align-map: (
  'items-start': flex-start,
  'items-center': center,
  'items-end': flex-end,
  'items-stretch': stretch,
  'justify-start': flex-start,
  'justify-center': center,
  'justify-end': flex-end,
  'justify-between': space-between,
);

// Sizing
$size-map: (
  'w-full': 100%,
  'w-auto': auto,
  'w-screen': 100vw,
  'h-full': 100%,
  'h-auto': auto,
  'h-screen': 100dvh,
  'min-h-screen': 100dvh,
  'max-w-full': 100%,
);

// ==========================================================================
// 2. GENERATOR MIXIN
// ==========================================================================
@mixin generate-utilities($prefix: '') {
  // --- A. LAYOUT ---
  @each $class, $value in $display-map {
    .#{$prefix}#{$class} {
      display: $value;
    }
  }

  // --- B. FLEXBOX ---
  @each $class, $value in $flex-dir-map {
    @if $value == wrap or $value == nowrap {
      .#{$prefix}#{$class} {
        flex-wrap: $value;
      }
    } @else {
      .#{$prefix}#{$class} {
        flex-direction: $value;
      }
    }
  }
  @each $class, $value in $align-map {
    // Determine property based on class name using 'string.index' instead of 'str-index'
    @if string.index($class, 'items') {
      .#{$prefix}#{$class} {
        align-items: $value;
      }
    } @else {
      .#{$prefix}#{$class} {
        justify-content: $value;
      }
    }
  }

  .#{$prefix}flex-1 {
    flex: 1 1 0%;
  }
  .#{$prefix}flex-none {
    flex: none;
  }

  // --- C. GRID ---
  .#{$prefix}grid-cols-1 {
    grid-template-columns: repeat(1, minmax(0, 1fr));
  }
  .#{$prefix}grid-cols-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  // --- D. SIZING ---
  @each $class, $value in $size-map {
    .#{$prefix}#{$class} {
      // Updated string functions to string.slice and string.index
      @if string.slice($class, 1, 1) == 'w' or string.index($class, 'max-w') {
        width: $value;
      } @else {
        height: $value;
      }
    }
  }

  // --- E. SPACING LOOP (p-, m-, gap-) ---
  @each $name, $size in $spacing-scale {
    $val: var(--space-#{$name});

    // Padding
    .#{$prefix}p-0 {
      padding: 0;
    }
    .#{$prefix}p-#{$name} {
      padding: $val;
    }
    .#{$prefix}px-#{$name} {
      padding-inline: $val;
    }
    .#{$prefix}py-#{$name} {
      padding-block: $val;
    }
    .#{$prefix}pt-#{$name} {
      padding-top: $val;
    }
    .#{$prefix}pb-#{$name} {
      padding-bottom: $val;
    }

    // Margin
    .#{$prefix}m-0 {
      margin: 0;
    }
    .#{$prefix}m-#{$name} {
      margin: $val;
    }
    .#{$prefix}mx-#{$name} {
      margin-inline: $val;
    }
    .#{$prefix}my-#{$name} {
      margin-block: $val;
    }
    .#{$prefix}mt-#{$name} {
      margin-top: $val;
    }
    .#{$prefix}mb-#{$name} {
      margin-bottom: $val;
    }

    // Gap
    .#{$prefix}gap-#{$name} {
      gap: $val;
    }
  }

  // Auto Margins
  .#{$prefix}mx-auto {
    margin-inline: auto;
  }
  .#{$prefix}my-auto {
    margin-block: auto;
  }
}

// ==========================================================================
// 3. EXECUTION (Generate Classes)
// ==========================================================================

// 1. BASE (Works everywhere)
@include generate-utilities('');

// 2. RESPONSIVE (e.g., tablet:p-md)
@each $bp, $value in $breakpoints {
  @if $value != 0 {
    @include respond-up($bp) {
      // The slash is required to escape the colon in SCSS class names
      @include generate-utilities('#{$bp}\\:');
    }
  }
}

// ==========================================================================
// 4. VISUAL HELPERS (Physics & Radius)
// ==========================================================================

// Radius
@each $name, $value in $radius-scale {
  .rounded-#{$name} {
    border-radius: var(--radius-#{$name});
  }
}
.rounded-none {
  border-radius: 0;
}
.rounded {
  border-radius: var(--radius-md);
} // Default

// Blur
.backdrop-blur-physics {
  -webkit-backdrop-filter: blur(var(--physics-blur));
  backdrop-filter: blur(var(--physics-blur));
}

// Text Alignment
.text-center {
  text-align: center;
}
.text-left {
  text-align: left;
}
.text-right {
  text-align: right;
}

// Text Transform
.text-uppercase {
  text-transform: uppercase;
}
.text-capitalize {
  text-transform: capitalize;
}

// Text Colors
.text-main {
  color: var(--text-main);
}
.text-dim {
  color: var(--text-dim);
}
.text-muted {
  color: var(--text-muted);
}
.text-highlight {
  @include text-glow;
  font-weight: 600;
}
.text-success {
  color: var(--color-success);
}
.text-error {
  color: var(--color-error);
}
.text-premium {
  color: var(--color-premium);
}
.text-system {
  color: var(--color-system);
}

// Accessibility
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// ==========================================================================
// 5. ANIMATIONS & EXTRAS
// ==========================================================================

// Transitions
.fade-in {
  @include entry-transition;
}

// Loading
.shimmer {
  @include shimmer;
}
.loading-logo {
  width: 8rem;
  aspect-ratio: 1/1;
  animation: logo-enter 1.2s var(--ease-snap) forwards;
}

// Interactive
.cyber-pulse {
  animation: cyber-pulse 3s var(--ease-pulse) infinite;
}

// Progress Bar
.progress-bar {
  width: 100%;
  height: 4px;
  background: var(--bg-sink);
  border-radius: 2px;
  overflow: hidden;

  span {
    display: block;
    height: 100%;
    background: linear-gradient(
      135deg,
      var(--energy-primary),
      var(--energy-secondary)
    );
    box-shadow: 0 0 10px alpha(var(--energy-primary), 60%);
    border-radius: inherit;
    animation: progress-fill 2s ease-out forwards;
  }
}

// ==========================================================================
// 6. ICONS
// ==========================================================================

.icon {
  width: 1.25em;
  height: 1.25em;
  min-width: 1.25em;
  display: inline-block;
  vertical-align: middle;
  color: inherit;
  transition: transform var(--speed-fast) var(--ease-snap);
}

.icon-sm {
  width: 1em;
  height: 1em;
  min-width: 1em;
}
.icon-lg {
  width: 1.5em;
  height: 1.5em;
  min-width: 1.5em;
}
.icon-xl {
  width: 2em;
  height: 2em;
  min-width: 2em;
}

.icon-spin {
  animation: rotate-laser 2s linear infinite;
}
