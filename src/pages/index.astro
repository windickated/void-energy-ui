---
import '../styles/global.scss';

import VoidEnergyUI from '../components/index.svelte';
import Modal from '../components/Modal.svelte';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Void Energy UI</title>

    <script is:inline>
      (function () {
        try {
          const root = document.documentElement;
          const store = localStorage;

          // ----------------------------------------------------------------
          // 1. RESTORE ATMOSPHERE & PHYSICS (The Triad)
          // ----------------------------------------------------------------
          const savedAtmosphere = store.getItem('void_atmosphere') || 'void';
          root.setAttribute('data-atmosphere', savedAtmosphere);

          // Manually derive physics/mode here because the TS Engine hasn't loaded yet.
          let physics = 'glass';
          let mode = 'dark';

          if (savedAtmosphere === 'terminal') {
            physics = 'retro';
          } else if (['paper', 'laboratory'].includes(savedAtmosphere)) {
            physics = 'flat';
            mode = 'light';
          }

          root.setAttribute('data-physics', physics);
          root.setAttribute('data-mode', mode);

          // ----------------------------------------------------------------
          // 2. RESTORE USER CONFIG (Fonts & Scale)
          // ----------------------------------------------------------------
          const rawConfig = store.getItem('void_user_config');

          if (rawConfig) {
            const config = JSON.parse(rawConfig);

            // Restore Scale
            if (config.scale) {
              // Clamp to safe limits just in case
              const safeScale = Math.min(Math.max(config.scale, 0.75), 2);
              root.style.setProperty('--text-scale', safeScale);
            }

            // Restore Body Font
            if (config.fontBody) {
              root.style.setProperty('--user-font-body', config.fontBody);
            }

            // Restore Heading Font
            if (config.fontHeading) {
              root.style.setProperty('--user-font-heading', config.fontHeading);
            }
          }
        } catch (e) {
          // If JSON parse fails or storage is blocked, we fail silently.
          // The CSS default variables will take over.
          console.warn('Void Energy hydration script failed:', e);
        }
      })();
    </script>
  </head>
  <body>
    <VoidEnergyUI client:load />
    <Modal client:load />
  </body>
</html>
